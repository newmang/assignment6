<!DOCTYPE html>
<html>
  <head>
    <script>
    // Module Name: scores.html
    // Elijah Newman-Gomez
    // Assignment X
    // CSE 594
    //
    // Description:
    // This page acts as the start screen and the end-game screen for Newmang Squares.
    // In either case, it will display the top scores of the user's Facebook friends.
    // It will also show the user's personal best high score.
    //
    // If there is a score in the window.localStorage key labeled "myScore", then it
    // is displayed as the last game's score.
    //
    // If the "myScore" value is higher than the user's current high score on Facebook,
    // then their high score on Facebook gets updated and the user has the option to
    // post their new high score to their Facebook wall as well.
    //
    // The bottom of this page has the main menu buttons for Newmang Squares.
    </script>
  </head>

<body>

  <button onclick="login()">Login</button>
  <div id="fb-root"></div>

  <!-- cordova -->
  <script src="phonegap.js"></script>
  <!-- cordova facebook plugin -->
  <script src="cdv-plugin-fb-connect.js"></script>
  <!-- facebook js sdk -->
  <script src="facebook-js-sdk.js"></script>
        
<script>

function DrawLoginButton() {
  alert("Draw the login button.");
}

function DrawTopScores() {
  alert("Draw top scores.");
}

function login() {
  FB.login(function(response) { return; }, { scope: "publish_actions" });
}

function loginResponse(response) {
  if( response.status === 'connected' ) {
    FB.api('/me/permissions', function (permissions) {
alert(permissions.data[0]["publish_actions"]);
      if( permissions.data.publish_actions === undefined ) {
        DrawLoginButton();
      }
      else {
        DrawTopScores();
      } 
    });
  }
  else {
    alert("not connected");
    login();
  }
}

document.addEventListener('deviceready', function() {
  FB.init({ appId: "473600756038526", nativeInterface: CDV.FB, useCachedDialogs: false });
  FB.getLoginStatus(function(response) {
    FB.Event.subscribe('auth.login', function(response) { loginResponse(response); });
    loginResponse(response);
  });
}, false);

</script>
</body>
</html>